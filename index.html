<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nut and Sacha Wedding</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tangerine:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* ---------- Fonts & helpers ---------- */
    .font-tangerine { font-family: 'Tangerine', cursive; }
    .font-courier { font-family: 'Courier New', monospace; }
    .font-georgia { font-family: 'Georgia', serif; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    html { scroll-behavior: smooth; }

    /* ---------- Preloader ---------- */
    #preloader {
      position: fixed; inset: 0; background: #fff; z-index: 9999;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: opacity .8s ease, visibility .8s ease;
    }
    #preloader.hidden { opacity: 0; visibility: hidden; }
    .loader {
      border: 4px solid #e5e7eb; border-top: 4px solid #111827; border-radius: 50%;
      width: 56px; height: 56px; animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ---------- Motion tokens ---------- */
    :root { --eio: cubic-bezier(.22,.61,.36,1); } /* gentle ease-out */

    /* gentle reveals used elsewhere */
    .reveal    { opacity: 0; transform: translateY(14px); transition: opacity .8s var(--eio), transform .8s var(--eio); }
    .reveal.in { opacity: 1; transform: translateY(0); }
    .reveal-soft    { opacity: 0; transition: opacity .9s var(--eio); }
    .reveal-soft.in { opacity: 1; }
    .reveal-zoom    { opacity: 0; transform: scale(.985); transition: opacity .9s var(--eio), transform .9s var(--eio); transform-origin: center; }
    .reveal-zoom.in { opacity: 1; transform: scale(1); }
    .d1 { transition-delay: .06s; } .d2 { transition-delay: .12s; } .d3 { transition-delay: .18s; }

    /* Hero title intro */
    @keyframes headingIntro {
      0%   { opacity: 0; transform: translateY(10px) scale(.985); }
      100% { opacity: 1; transform: translateY(0)    scale(1); }
    }
    .heading-intro { animation: headingIntro 900ms var(--eio) both; }

    /* Countdown (no blink) */
    .timebox{
      background: rgba(255,255,255,.16);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,.25);
      border-radius: 14px;
      padding: .6rem .75rem;
      text-align: center;
      box-shadow: 0 6px 20px rgba(0,0,0,.08);
    }
    .timebox .value{
      font-family: 'Courier New', monospace;
      font-variant-numeric: tabular-nums;
      font-weight: 700;
      font-size: clamp(20px, 4.2vw, 34px);
      line-height: 1.1;
      transition: transform .25s var(--eio);
    }
    .timebox .label{ font-size: .7rem; letter-spacing: .04em; opacity: .9; }
    .value.tick { transform: translateY(-6%); }
    #countdown {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px;
      max-width: 300px; margin: 1rem auto 0;
    }
    .timebox { aspect-ratio: 1 / 1.05; }

    /* Section rhythm */
    section { isolation: isolate; }
    .section-pad { padding-top: clamp(2rem, 5vw, 4rem); padding-bottom: clamp(2rem, 5vw, 4rem); }

    /* Buttons */
    .btn { transition: transform .15s var(--eio), box-shadow .15s var(--eio), background-color .15s var(--eio), color .15s var(--eio); }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(0,0,0,.12); }

    /* ---------- COUPLE: smooth fly-in (no blur/filter) ---------- */
    .fly-card {
      opacity: 0;
      transform: translateX(0); /* set by variant classes below */
      transition: opacity .9s var(--eio), transform .9s var(--eio);
      will-change: transform, opacity;
      text-align: center;
    }
    .fly-left   { transform: translateX(-28px); }
    .fly-right  { transform: translateX( 28px); }
    .fly-card.in { opacity: 1; transform: translateX(0); }
    .fly-card:hover { transform: translateX(0) translateY(-3px); }

    .portrait {
      width: min(25vh, 220px);
      height: min(25vh, 220px);
      border-radius: 9999px;
      object-fit: cover;
      background: #fff;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      /* No filters, no blur */
    }

    .couple-meta {
      opacity: 0;
      transform: translateY(6px);
      transition: opacity .8s var(--eio) .12s, transform .8s var(--eio) .12s;
    }
    .couple-meta.in { opacity: 1; transform: translateY(0); }

    /* ---- RSVP Button (new) ---- */
    .rsvp-btn {
      display: inline-block;
      background: linear-gradient(90deg, #fbcfe8 0%, #f5d0fe 100%);
      color: #374151;
      font-family: 'Courier New', monospace;
      font-weight: 700;
      padding: 0.9rem 1.6rem;
      border-radius: 9999px;
      box-shadow: 0 8px 22px rgba(0,0,0,.12);
      transition: transform .22s var(--eio), box-shadow .22s var(--eio), background .22s var(--eio);
    }
    .rsvp-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 28px rgba(0,0,0,.16);
      background: linear-gradient(90deg, #f9a8d4 0%, #e9d5ff 100%);
    }

    /* Motion accessibility */
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: .001ms !important; animation-iteration-count: 1 !important; transition-duration: .001ms !important; scroll-behavior: auto !important; }
    }

    /* Mobile tweaks */
    @media (max-width: 480px) {
      #countdown { max-width: 260px; gap: 5px; }
      .timebox { border-radius: 10px; }
      .timebox .value { font-size: 16px; }
      .timebox .label { font-size: 0.56rem; }
    }
  </style>
</head>
<body class="bg-white text-gray-900">

  <!-- PRELOADER -->
  <div id="preloader">
    <div class="loader mb-4"></div>
    <p class="font-courier text-gray-700">Loading memories...</p>
  </div>

  <!-- Sticky top nav -->
  <header class="sticky top-0 z-[60] bg-white/85 backdrop-blur border-b border-gray-200">
    <nav class="max-w-6xl mx-auto px-4 py-2 flex items-center justify-between">
      <a href="#home" class="font-tangerine text-3xl">N & S</a>
      <div class="flex gap-4 text-sm font-courier">
        <a href="#home" class="hover:opacity-70">Home</a>
        <a href="#couple" class="hover:opacity-70">Couple</a>
        <a href="#gallery" class="hover:opacity-70">Gallery</a>
        <a href="#map" class="hover:opacity-70">Map</a>
      </div>
    </nav>
  </header>

  <main class="w-full">
    <!-- HERO -->
    <section id="home" class="relative h-[92vh] w-full">
      <video id="heroVideo" autoplay muted loop playsinline class="absolute inset-0 h-full w-full object-cover"></video>
      <div class="absolute inset-0 bg-gradient-to-b from-black/40 via-black/25 to-black/40"></div>

      <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center text-white px-3 z-10">
        <h1 class="font-tangerine font-bold text-6xl md:text-7xl drop-shadow heading-intro">Nutnaree & Sacha</h1>
        <p class="font-courier text-lg md:text-xl mt-2 reveal-soft d1">29 December 2025</p>
        <p class="font-courier text-lg md:text-xl reveal-soft d2">Rama9, Bangkok</p>

        <div id="countdown" class="mt-5 grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3 w-full max-w-[320px] md:max-w-xl mx-auto reveal-zoom d3">
          <div class="timebox"><div id="days" class="value">00</div><div class="label">Days</div></div>
          <div class="timebox"><div id="hours" class="value">00</div><div class="label">Hours</div></div>
          <div class="timebox"><div id="minutes" class="value">00</div><div class="label">Minutes</div></div>
          <div class="timebox"><div id="seconds" class="value">00</div><div class="label">Seconds</div></div>
        </div>
      </div>
    </section>

    <!-- INTRO LINES -->
    <section class="section-pad text-center">
      <p class="font-courier text-base reveal">THE HONOUR OF YOUR PRESENCE IS REQUESTED</p>
      <p class="font-courier text-base reveal d1">AT THE MARRIAGE CELEBRATION OF</p>
    </section>

    <!-- COUPLE (smooth fly-in, no blur/filter) -->
    <section id="couple" class="px-4 max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 section-pad">
      <!-- Bride -->
      <div class="flex flex-col items-center">
        <div class="fly-card fly-left" data-reveal="fly-card">
          <img id="brideImg" alt="Bride" class="portrait" />
        </div>
        <div class="couple-meta mt-3" data-reveal="meta">
          <p class="font-tangerine text-3xl">Bride</p>
          <p class="font-georgia text-xl">Nutnaree Luksachob</p>
        </div>
      </div>
      <!-- Groom -->
      <div class="flex flex-col items-center">
        <div class="fly-card fly-right" data-reveal="fly-card">
          <img id="groomImg" alt="Groom" class="portrait" />
        </div>
        <div class="couple-meta mt-3" data-reveal="meta">
          <p class="font-tangerine text-3xl">Groom</p>
          <p class="font-georgia text-xl">Sacha XXXXX</p>
        </div>
      </div>
    </section>

    <!-- MONOGRAM / DATE -->
    <section class="px-4 text-center section-pad">
      <img id="logoImg" alt="Logo" class="mx-auto w-[30vh] h-auto" />
      <div class="mt-4">
        <p class="font-courier text-base reveal">LET'S CELEBRATE TOGETHER ON</p>
        <p class="font-courier text-base reveal d1">OUR SPECIAL DAY ON</p>
        <p class="font-courier text-2xl font-semibold reveal d2">29 December 2025</p>
      </div>
    </section>

    <!-- CAROUSEL -->
    <section class="my-6">
      <div class="relative max-w-6xl mx-auto">
        <div id="snapCarousel" class="w-full overflow-x-auto no-scrollbar snap-x snap-mandatory flex gap-4 px-4 reveal"></div>
        <div class="mt-4 flex justify-center gap-3">
          <button id="prevBtn" class="btn px-4 py-2 rounded-full bg-gray-900 text-white/90 hover:text-white hover:bg-gray-800">Prev</button>
          <button id="nextBtn" class="btn px-4 py-2 rounded-full bg-gray-900 text-white/90 hover:text-white hover:bg-gray-800">Next</button>
        </div>
      </div>
    </section>

    <!-- GALLERY -->
    <section id="gallery" class="py-10 bg-[#fafafa]">
      <h4 class="text-center mb-6 font-courier reveal">More Memories</h4>
      <div id="galleryGrid" class="max-w-6xl mx-auto px-4 grid grid-cols-2 md:grid-cols-3 gap-4">
        <!-- images injected -->
      </div>
    </section>

    <!-- SPLIT MESSAGE + PHOTO -->
    <section class="grid grid-cols-1 lg:grid-cols-2 min-h-[70vh] section-pad">
      <div class="flex items-center justify-center text-center p-6">
        <div class="max-w-2xl">
          <p class="font-courier text-2xl md:text-3xl leading-relaxed reveal">
            “เพื่อให้เราสามารถวางแผนในการดูแลท่าน ซึ่งเป็นแขกคนสำคัญได้อย่างเต็มที่
            ขอรบกวนทุกท่านทำแบบตอบรับการเข้าร่วมงานให้เราด้วยนะคะ/ครับ”
          </p>
          <p class="font-courier text-2xl md:text-3xl mt-6 reveal d2">“HOPE TO SEE YOU AT OUR WEDDING”</p>
        </div>
      </div>
      <div class="relative">
        <img id="splitImg" alt="Split" class="w-full h-full object-cover" />
        <div class="pointer-events-none absolute inset-x-0 bottom-0 h-12 bg-gradient-to-b from-transparent to-white"></div>
      </div>
    </section>

    <!-- ===== RSVP (new, before Map) ===== -->
    <section id="rsvp" class="section-pad text-center">
      <a href="https://google.com" target="_blank" rel="noopener noreferrer"
         class="rsvp-btn reveal" aria-label="Open RSVP form in new tab">
        RSVP NOW
      </a>
    </section>

    <!-- MAP -->
    <section id="map" class="section-pad">
      <h4 class="text-center mb-4 font-courier reveal">Wedding Location</h4>
      <div class="max-w-5xl mx-auto px-4 reveal-zoom d1">
        <div class="relative rounded-xl overflow-hidden bg-white shadow-xl ring-1 ring-black/5">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3875.850136597468!2d100.49281291536477!3d13.75633039035286!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30e2992e2df7f5c3%3A0xa1e4c8e7b98a898!2sGrand%20Palace!5e0!3m2!1sen!2sth!4v1685349642793!5m2!1sen!2sth"
            class="block w-full [aspect-ratio:16/9]" style="border:0;" allowfullscreen loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
    </section>
  </main>

  <!-- ========================= Firebase + Logic ========================= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDxlQWFYRcbGZ133HPEMXYy8tR_KMUiJw0",
      authDomain: "lottogame-16083.firebaseapp.com",
      projectId: "lottogame-16083",
      storageBucket: "lottogame-16083.firebasestorage.app",
      messagingSenderId: "278778623701",
      appId: "1:278778623701:web:c7828b036c617a13fa145c"
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);

    const files = {
      video: "BeachVDO3.mp4",
      heroImages: ["BeachPhoto24.jpg", "BeachPhoto2.jpg", "BeachPhoto8.jpg", "BeachPhoto15.jpg"],
      gallery: ["Studio18.jpg", "Studio30.jpg", "Studio12.jpg", "Studio19.jpg", "Studio11.jpg", "Studio35.jpg"],
      bride: "Studio22.jpg",
      groom: "Studio23.jpg",
      split: "Studio33.jpg",
      logo: "logo.png"
    };

    // Helpers
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    async function setSrc(el, file) {
      if (el.tagName === "VIDEO") return setVideo(el, file);
      try {
        const url = await getDownloadURL(ref(storage, file));
        el.src = url;
        el.loading = "lazy";
        el.decoding = "async";
      } catch (e) { console.error("Image load failed:", file, e); }
    }
    async function setVideo(videoEl, file) {
      try {
        const url = await getDownloadURL(ref(storage, file));
        videoEl.src = url; videoEl.muted = true; videoEl.playsInline = true; videoEl.autoplay = true;
        videoEl.addEventListener("canplay", async () => {
          try { await videoEl.play(); } catch (err) { console.warn("Autoplay blocked:", err); }
        }, { once: true });
      } catch (e) { console.error("Video load failed:", file, e); }
    }

    async function buildCarousel() {
      const scroller = document.getElementById("snapCarousel");
      scroller.innerHTML = "";
      for (const name of files.heroImages) {
        const url = await getDownloadURL(ref(storage, name));
        const img = document.createElement("img");
        img.src = url; img.alt = name;
        img.className = "snap-center shrink-0 w-full md:w-[80%] lg:w-[70%] h-[45vh] md:h-[65vh] object-cover rounded-xl shadow";
        scroller.appendChild(img);
      }
      const step = () => scroller.clientWidth * 0.8;
      document.getElementById('prevBtn')?.addEventListener('click', () => scroller.scrollBy({ left: -step(), behavior: 'smooth' }));
      document.getElementById('nextBtn')?.addEventListener('click', () => scroller.scrollBy({ left: step(), behavior: 'smooth' }));

      // gentle snap assist
      let t;
      scroller.addEventListener('scroll', () => {
        clearTimeout(t);
        t = setTimeout(() => {
          const children = Array.from(scroller.children);
          const x = scroller.scrollLeft + scroller.clientWidth / 2;
          let closest = null; let closestDist = Infinity;
          children.forEach(ch => {
            const rect = ch.getBoundingClientRect();
            const center = rect.left + rect.width / 2 + scroller.scrollLeft;
            const d = Math.abs(center - x);
            if (d < closestDist) { closest = ch; closestDist = d; }
          });
          closest?.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
        }, 120);
      }, { passive: true });
    }

    async function buildGallery() {
      const grid = document.getElementById("galleryGrid");
      grid.innerHTML = "";
      for (const [i, name] of files.gallery.entries()) {
        const url = await getDownloadURL(ref(storage, name));
        const card = document.createElement("div");
        card.className = "flex items-center justify-center bg-white rounded-lg overflow-hidden shadow-md aspect-[3/4] reveal-zoom";
        card.style.transitionDelay = (0.05 * (i % 6)) + "s";

        const img = document.createElement("img");
        img.src = url; img.alt = name;
        img.loading = "lazy"; img.decoding = "async";
        img.className = "max-h-full max-w-full object-contain";
        img.addEventListener("load", () => card.classList.add("in"), { once: true });

        card.appendChild(img);
        grid.appendChild(card);
      }
    }

    async function loadMedia() {
      const heroVideo = document.getElementById("heroVideo");
      await Promise.all([
        setSrc(heroVideo, files.video),
        setSrc(document.getElementById("brideImg"), files.bride),
        setSrc(document.getElementById("groomImg"), files.groom),
        setSrc(document.getElementById("splitImg"), files.split),
        setSrc(document.getElementById("logoImg"), files.logo),
        buildCarousel(),
        buildGallery()
      ]);

      // Hide preloader when hero video can play or after a short fallback
      const pre = document.getElementById("preloader");
      if (heroVideo.readyState >= 3) {
        pre.classList.add("hidden");
      } else {
        const done = () => pre.classList.add("hidden");
        heroVideo.addEventListener("canplaythrough", done, { once: true });
        setTimeout(done, 2000);
      }
    }

    // Countdown
    const weddingDate = new Date("2025-12-29T17:00:00+07:00").getTime();
    function setVal(id, newVal) {
      const el = document.getElementById(id); if (!el) return;
      const next = String(newVal).padStart(2, '0');
      if (el.textContent === next) return;
      el.textContent = next; el.classList.add('tick');
      setTimeout(() => el.classList.remove('tick'), 240);
    }
    function updateCountdown() {
      const now = Date.now();
      const distance = weddingDate - now;
      if (distance <= 0) {
        const wrap = document.getElementById("countdown");
        if (wrap) wrap.innerHTML = "<p class='font-courier text-xl'>It's Wedding Time!</p>";
        return;
      }
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      setVal("days", days); setVal("hours", hours); setVal("minutes", minutes); setVal("seconds", seconds);
    }
    updateCountdown(); setInterval(updateCountdown, 1000);

    /* ---------- Generic gentle reveals ---------- */
    function setupReveal() {
      const els = document.querySelectorAll('.reveal, .reveal-soft, .reveal-zoom');
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            e.target.classList.add('in');
            io.unobserve(e.target);
          }
        });
      }, { threshold: 0.12, rootMargin: "0px 0px -40px 0px" });
      els.forEach(el => io.observe(el));
    }

    /* ---------- Couple fly-in ---------- */
    (function setupCoupleFlyIn(){
      const cards = document.querySelectorAll('[data-reveal="fly-card"]');
      if (!cards.length) return;
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (e.isIntersecting) {
            const el = e.target;
            el.classList.add('in');
            el.closest('.flex.flex-col.items-center')
              ?.querySelector('[data-reveal="meta"]')
              ?.classList.add('in');
            io.unobserve(el);
          }
        });
      }, { threshold: 0.2, rootMargin: "0px 0px -10%" });
      cards.forEach(c => io.observe(c));
    })();

    // Boot
    loadMedia();
    setupReveal();
  </script>
</body>
</html>
